syntax = "proto3";

package gantry.service.v1;
option go_package = "github.com/ratdaddy/blockcloset/proto/gen/go/gantry/service/v1;servicev1";

import "gantry/bucket/v1/bucket.proto";

service GantryService {
  rpc CreateBucket(CreateBucketRequest) returns (CreateBucketResponse);
  rpc ListBuckets(ListBucketsRequest) returns (ListBucketsResponse);
  rpc ResolveWrite(ResolveWriteRequest) returns (ResolveWriteResponse);
}

message CreateBucketRequest {
  string name = 1;
}

message CreateBucketResponse {
  gantry.bucket.v1.Bucket bucket = 1;
}

message BucketOwnershipConflict {
  enum Reason {
    REASON_UNSPECIFIED = 0;
    REASON_BUCKET_ALREADY_OWNED_BY_YOU = 1;
    REASON_BUCKET_ALREADY_EXISTS = 2;
  }

  Reason reason = 1;
  string bucket = 2;
}

message ListBucketsRequest {}

message ListBucketsResponse {
  repeated gantry.bucket.v1.Bucket buckets = 1;
}

message ResolveWriteRequest {
  string bucket = 1;
  string key = 2;
  int64 size = 3;
}

message ResolveWriteResponse {
  string object_id = 1;
  string cradle_address = 2;
}

// Error detail for failures in ResolveWrite
message ResolveWriteError {
  enum Reason {
    REASON_UNSPECIFIED = 0;
    REASON_BUCKET_NOT_FOUND = 1;
    REASON_BUCKET_ACCESS_DENIED = 2;
    REASON_NO_CRADLE_SERVERS = 3;
  }
  Reason reason = 1;
  string bucket = 2;
}
